# Розділ 3: Основні команди та ієрархія каталогів

## Оболонка Борна: `/bin/sh`

Кожна система Unix потребує оболонки Bourne (`sh`) для правильного функціонування.

Оболонка *bash* (`Bourne Again Shell`) є типовою оболонкою для більшості дистрибутивів Linux, а `/bin/sh` зазвичай є посиланням на `bash` у системі Linux.

Коли ви встановлюєте Linux, ви повинні створити принаймні одного звичайного користувача на додаток до користувача root.

## Використання оболонки

### Вікно оболонки

Одна з базових команд -- `cat`. Вона виводить вміст одного або кількох файлів.

Процеси Unix використовують потоки введення/виведення для читання та запису даних.

Джерелом вхідного потоку може бути файл, пристрій, термінал або навіть вихідний потік від іншого процесу.

Натискання `ctrl-D` у порожньому рядку зупиняє поточний стандартний ввід із термінала, `ctrl-C` завершує процес.

Ядро надає кожному процесу стандартний потік виведення, куди він може записувати свої повідомлення.

## Основні команди

Деякі основні команди:

- `cat`: виводить вміст файлу
- `ls`: виводить список вмісту каталогу. Використовуйте `-l` для детального переліку та `-F` для відображення інформації про тип файлу
- `cp`: копіює файли
- `mv`: переміщує (перейменовує) файли
- `touch`: створює файл, якщо файл не існує, а якщо він існує, змінює мітку часу модифікації файлу
- `rm`: видаляє файл
- `echo`: виводить свої аргументи на стандартний вивід
- `wc`: підраховує кількість слів, рядків та символів у файлі. Використовуйте `-l` для підрахунку рядків
- `basename`: повертає ім’я файлу без каталогу

## Отримання онлайн-довідки

Щодо базових команд, сторінки посібника (або сторінки довідки) розкажуть вам усе: `man ls`.

Щоб шукати сторінку посібника за ключовим словом, використовуйте параметр `-k`.

Сторінки довідки позначаються пронумерованими розділами, і ви можете вибрати сторінку довідки за розділом : `man 5 passwd`.

![Man Page Sections](images/Table2-3.png)

Існує ще один формат під назвою `info` : `info command`.

Деякі пакунки зберігають доступну документацію у `/usr/share/doc`.

## Перегляд історії команд

Стрілка вгору виводить попередню команду, а стрілка вниз виводить наступну команду.

- `history`: виводить список останніх команд

Також можна проводити пошук в історії команд за допомогою `ctrl-R`.

## Каталоги та файлова система

![Linux Filesystem](images/Figure2-2.png)

- `/` : кореневий каталог
- `.` : поточний каталог
- `..` : батьківський каталог

Якщо шлях починається з `/`, це абсолютний шлях, в іншому випадку це відносний шлях.

## Навігація каталогами

Деякі важливі команди навігації по директоріях:

- `cd`: поточний робочий каталог – це каталог, у якому зараз знаходиться процес. Команда `cd` змінює поточний робочий каталог оболонки
- `mkdir`: створює каталог
- `rmdir`: видаляє каталог

### Shell Globbing

Оболонка може зіставляти прості шаблони з назвами файлів і каталогів, ця функціональність називається `globbing` (наприклад `*` відповідає будь-якій кількості довільних символів).

Оболонка зіставляє аргументи, що містять глоби, з іменами файлів, замінює імена файлів на ці аргументи, а потім запускає оновлену команду, що називається розширенням.

Символ оболонки `?` наказує оболонці підставити рівно один довільний символ.

Якщо ви не хочете, щоб оболонка розгортала глоб у команді, візьміть глоб в одинарні лапки.

## Команди advanced-рівня

Інші важливі advanced-рівня команди Unix:

- `grep`: друкує рядки з файлу або вхідного потоку, які відповідають виразу (друкує назву файлу на додаток до відповідного рядка). Використовуйте `-i` для збігів без урахування регістру та `-v` для інвертованих збігів (які не містять вираз)
- `egrep`: подібний до `grep`, але він розпізнає розширені регулярні вирази
- `less`: друкує вміст файлу на один екран за раз (пробіл для переходу вперед у файлі та клавіша `b` для пропуску на один екран назад і `q` для виходу). Щоб шукати слово вперед, введіть `/word`, а для пошуку назад використовуйте `?word`
- `pwd`: друкує поточний робочий каталог
- `diff`: друкує різницю між двома файлами
- `file`: друкує тип файлу
- `find`: Запустіть `find`, щоб знайти файл у каталозі. Команда `find` приймає спеціальні символи, які відповідають шаблону, наприклад `*`, але ви повинні взяти їх в одинарні лапки (`*`), щоб захистити спеціальні символи від власної функції оболонки `globbing`, оскільки оболонка розгортає глоби перед виконанням команд
- `locate`: схоже на `find`, але ця команда шукає індекс, який система створює періодично, замість того, щоб запускати його в режимі реального часу (тому це швидше)
- `head`: друкує початок файлу, використовуйте `-n`, щоб вказати кількість рядків
- `tail`: друкує кінець файлу, використовуйте `-n`, щоб вказати кількість рядків
- `sort`: сортує рядки файлу
- `uniq`: видаляє повторення рядків у файлі. Використовуйте `-c`, щоб підрахувати кількість повторень кожного рядка або `-d`, щоб вивести тільки повторення

## Зміна пароля та оболонки

Використовуйте команду `passwd`, щоб змінити свій пароль.

Команда запитає старий пароль, перш ніж дозволить вам ввести новий.

## Файли, що починаються з крапки

Файли, які починаються з крапки називають *прихованими*, та вони не відображаються за замовчуванням у деяких програмах, таких як `ls` (якщо ви не запускаєте їх із параметром `-a`).

Глоби оболонки не збігаються з такими файлами, якщо ви явно не використовуєте такий шаблон, як `.*`.

## Змінні середовища та оболонки

Щоб присвоїти значення змінній оболонки, використовуйте знак рівності (`=`) : `TEST='test value'`.

Ви можете використовувати цю змінну за допомогою знака долара : `echo $TEST`.

Щоб створити змінну середовища (не специфічну для будь-якої оболонки), скористайтеся командою експорту : `export TEST='Це тест'`

## Командний шлях

`PATH` — це змінна середовища, яка містить список системних каталогів, які переглядає оболонка, намагаючись знайти команду.

## Спеціальні символи

- `*` -> Регулярний вираз, глоб
- `.` -> Поточний каталог, розділювач імені файлу/вузла
- `!` -> Заперечення, історія команд
- `|` -> Канали команд
- `/` -> Роздільник каталогу, команда пошуку
- `\` -> Літерали, макроси (ніколи каталоги)
- `$` -> Позначення змінної, кінець рядка
- `'` -> Буквені рядки
- `\`` -> Заміна команд
- `"` -> Напівбуквені рядки
- `^` -> Заперечення, початок рядка
- `~` -> Заперечення, ярлик каталогу
- `#` -> Коментарі, препроцесор, заміни
- `[ ]` -> Діапазони
- `{ }` -> Блоки операторів, діапазони
- `_` -> Замінник пробілу

## Редагування командного рядка

- `ctrl-B` Перемістити курсор ліворуч
- `ctrl-F` Перемістити курсор праворуч
- `ctrl-P` Переглянути попередню команду (або перемістити курсор вгору)
- `ctrl-N` Перегляд наступної команди (або переміщення курсора вниз)
- `ctrl-A` Перемістити курсор на початок рядка
- `ctrl-E` Перемістити курсор у кінець рядка
- `ctrl-W` Видалити попереднє слово
- `ctrl-U` Видалити від курсора до початку рядка
- `ctrl-K` Видалити від курсора до кінця рядка
- `ctrl-Y` Вставити стертий текст (наприклад, з `ctrl-U`)

## Текстові редактори

Існує два стандарти де-факто для текстових редакторів в Unix: `vi` (швидший) і `emacs` (може робити майже все, але вимагає додаткового введення).

Також існує `nano`, який є простішим використанням, ніж `vi` або `emacs`.

Для практики використання `vi` використовуйте `vimtutor`.

## Введення та виведення оболонки

Щоб надіслати виведення команди у файл замість термінала, використовуйте символ переспрямування `>`. Оболонка створює файл, якщо він ще не існує. Якщо файл існує, оболонка спочатку стирає (знищує) вихідний файл.

У bash можете встановити `-C` (`set -C`), щоб уникнути знищення наявного файлу.

Використовуйте `>>`, щоб уникнути перезапису файлу та продовжити запис із кінця файлу натомість.

Щоб переспрямувати стандартний потів виводу команди на стандартний потік введення іншої команди, використовуйте вертикальну лінію `|`.

### Стандартний потік помилок

Стандартний потік помилок (`stderr`); це додатковий вихідний потік для діагностики та налагодження.

Ви можете перенаправити стандартну помилку за допомогою синтаксису `2>` (`2` — це ідентифікатор потоку, який змінює оболонка), наприклад: `ls /fffffffff > f 2> e`.

Ви також можете надіслати стандартну помилку в те саме місце, що й stdout, із нотацією `>&` : `ls /fffffffff > f 2>&1`.

### Переспрямування стандартного потоку введення

Щоб спрямувати файл на введення програми, скористайтеся оператором `<`: `head < /proc/cpuinfo`

## Розуміння повідомлень про помилки

На відміну від повідомлень інших операційних систем, помилки Unix зазвичай повідомляють вам, що саме пішло не так.

### Анатомія повідомлення про помилку UNIX

Повідомлення про помилку UNIX зазвичай складається з кількох частин, таких як команда, яка була помилковою, файл, з яким вона діяла, і повідомлення про помилку.

Усуваючи помилки, завжди вирішуйте першу помилку.

### Поширені помилки

Список найпоширеніших повідомлень про помилки:

- `No such file or directory`: ви намагалися отримати доступ до файлу, якого не існуєhttps://lms.ithillel.ua/
- `File exists`: часто виникає, коли ви намагаєтеся створити каталог із такою ж назвою, як і файл
- `Not a directory, Is a directory`: з’являється, коли ви намагаєтеся використати файл як каталог або каталог як файл
- `No space left on device`: у вас закінчилося місце на диску
- `Permission denied`: ви намагаєтеся прочитати або записати файл або каталог, доступ до якого вам заборонений
- `Operation not permitted`: зазвичай це відбувається, коли ви намагаєтесь завершити процес, який вам не належить
- `Segmentation fault, Bus error`: програма намагалася отримати доступ до частини пам’яті, до якої їй було заборонено торкатися, і операційна система вбила її

## Перелік та маніпулювання процесами

Щоб отримати швидкий список запущених процесів, просто запустіть `ps` у командному рядку. Це відображає такі поля:

- `PID`: ідентифікатор процесу
- `TTY`: термінальний пристрій, на якому виконується процес. Про це пізніше
- `STAT`: стан процесу (`S` означає сплячий режим, `R` означає запущений)
- `TIME`: загальний час, який процес витратив на виконання інструкцій на процесорі
- `COMMAND`: це може здатися очевидним, але майте на увазі, що процес може змінити початкове значення цього поля

### Параметри команди `ps`

Команда ps має кілька корисних параметрів:

- `ps x`: Показати всі запущені процеси
- `ps ax`: Показати всі процеси в системі, а не лише ті, що належать вам
- `ps u`: Додати детальнішу інформацію про процеси
- `ps w`: Показувати повні назви команд, а не лише те, що вміщується в один рядок

Щоб перевірити певний процес, додайте його PID до списку аргументів команди ps. Щоб перевірити поточний процес оболонки, ви можете використати `ps u $$`, тому що `$$` є змінною оболонки, яка обчислює PID поточної оболонки.

### Команда `kill`

Щоб завершити процес, надішліть йому сигнал за допомогою команди `kill`. Коли ви запускаєте `kill`, ви просите ядро надіслати сигнал іншому процесу.

Сигнал — це повідомлення процесу від ядра. Існує багато типів сигналів. За замовчуванням `TERM` (тобто terminate -- завершити).

Ви можете передати параметри, наприклад, щоб заморозити процес: `kill -STOP pid`. Продовжувати з раніше зупиненим процесом використовуйте `CONT`: `kill -CONT pid`

### Керування задачами

Оболонки також підтримують керування задачами за допомогою різних комбінацій клавіш і команд.

Ви можете надіслати сигнал `TSTP` (схожий на `STOP`) за допомогою `ctrl-Z`, а потім розпочати процес знову, ввівши `fg` (перевести на передній план) або `bg` (перемістити на фон).

### Фонові процеси

Коли ви запускаєте команду Unix з оболонки, ви не отримуєте запрошення вводу оболонки, доки програма не завершить виконання.

Щоб від’єднати процес від оболонки та перевести його у фоновий режим, використовуйте `&`: `gunzip file.gz &`.

Якщо програма намагається прочитати щось зі стандартного введення, коли воно працює у фоновому режимі, вона може зависнути.

Оболонка bash і більшість повноекранних інтерактивних терміналів підтримують `ctrl-l` для перемальовування всього екрана.

## Система дозволів файлів

Кожен файл Unix має набір дозволів, які визначають, чи можете ви читати, писати або запускати файл. Першим символом режиму є тип файлу. Тире (`-`) у цій позиції позначає звичайний файл, а (`d`) позначає каталог. Решта режиму файлу містить дозволи, які розбиваються на три набори: власник, група та інші.

![File Permissions](images/Figure2-1.png)

Деякі виконувані файли мають `s` у списку дозволів власника замість `x`. Це вказує на те, що виконуваний файл має ідентифікатор `setuid`, тобто коли ви виконуєте програму, вона виконується так, ніби власником файлу є користувач, який власне її запустив.

### Змінення дозволів

Щоб змінити дозволи, використовуйте команду `chmod`.

Команда виглядає так: `chmod (target)[+-](permissions) <файл>`, де `target`:

- `g` для групи
- `o` для інших
- `u` для власника.

Ви також можете зробити це за допомогою чисел, наприклад, за допомогою числа `644` ви встановлюєте такі дозволи

- власник: читання/запис
- група, інші: читання

![File Permissions](images/Table2-4.png)

Ви можете вказати набір дозволів за замовчуванням за допомогою команди оболонки `umask`, яка застосовує попередньо визначений набір дозволів до будь-якого нового файлу, який ви створюєте (найпоширенішим є `022`).

## Файли Unix

![inode](images/inode.png)

### Символічні посилання

Символічне посилання — це файл, який вказує на інший файл або каталог, фактично створюючи псевдонім (імена, які вказують на інші імена). Позначається `->`, якщо виконується команда `ls`.

### Створення символічних посилань

Щоб створити символічне посилання від цілі до linkname, використовуйте `ln -s target linkname`.

## Архівація та стиснення файлів

### `gzip`

Одна з сучасних стандартних програм стиснення Unix. Файл із розширенням `.gz` є архівом GNU Zip.

`gzip` не пакує кілька файлів і каталогів в один файл.

### `tar`

Щоб створити файл архіву, виконайте `tar cvf archive.tar file1 file2 ...`.

Щоб розпакувати файл `.tar` за допомогою `tar`, використовуйте опцію `x` `tar xvf archive.tar`.

Ви можете отримати список вмісту файлу перед тим, як розпакувати його за допомогою параметра `t`.

Використовуйте `p`, щоб зберегти дозволи.

### Стиснуті архіви (`.tar.gz`)

Щоб розпакувати стислий архів, читайте розширення файлу справа наліво:

1. спочатку позбудьтеся `.gz`
1. потім займіться `.tar`

Це можна зробити комбінацією команд : `zcat file.tar.gz | tar xvf -`.

Параметр `z` у `tar` є скороченням для команди `zcat`: `tar ztvf f.tar.gz`.

Створити архів можна також додаючи опцію `z` до `tar` : `tar zcvf f.tar.gs file1 file2 ...`

### Інші утиліти стиснення

Існують інші утиліти стиснення, такі як `bzip2`. Варіант стиснення/декомпресії `bzip2` для `tar` — `j`.

## Основи ієрархії каталогів Linux

Ось найважливіші підкаталоги в корені:

- `/bin`: містить готові до запуску програми (також відомі як виконувані файли), включаючи більшість основних команд Unix
- `/dev`: містить файли пристроїв
- `/etc`: Цей основний каталог конфігурації системи. Містить пароль користувача, завантажувальний файл, файли пристрою, мережі та інші файли налаштування
- `/home`: містить особисті каталоги звичайних користувачів
- `/lib`: скорочення для _library_, цей каталог містить файли бібліотек, що містять код, який можуть використовувати виконувані файли.
Існує два типи бібліотек: статичні та динамічні. Каталог `/lib` має містити лише динамічні бібліотеки, але інші каталоги lib, такі як `/usr/lib`, містять обидва різновиди, а також інші допоміжні файли
- `/proc` Надає системну статистику через інтерфейс каталогів і файлів з можливістю перегляду. Каталог `/proc` містить інформацію про поточні запущені процеси, а також деякі параметри ядра
- `/sys`: цей каталог схожий на `/proc` тим, що забезпечує інтерфейс до пристроїв та системи
- `/sbin`: Місце для виконуваних файлів системи.
- `/tmp`: область зберігання для менших тимчасових файлів, які вам не дуже цікаві. Більшість дистрибутивів очищають `/tmp` під час завантаження машини, а деякі навіть періодично видаляють старі файли
- `/usr`: містить велику ієрархію каталогів, включаючи основну частину системи Linux
- `/var`: підкаталог змінних, де програми записують інформацію про виконання

### Інші кореневі підкаталоги

У кореневому каталозі є кілька інших цікавих підкаталогів:

- `/boot`: містить файли завантажувача ядра
- `/media`: базова точка приєднання для знімних носіїв, таких як флеш-накопичувачі, які є в багатьох дистрибутивах
- `/opt`: може містити додаткове стороннє програмне забезпечення

### Каталог /usr

На додаток до `/usr/bin`, `/usr/sbin` і `/usr/lib`, `/usr` містить наступне:

- `/include`: Зберігає файли заголовків, які використовуються компілятором C
- `/info`: Містить інформаційні посібники GNU
- `/local`: тут адміністратори можуть інсталювати власне програмне забезпечення
- `/man`: Містить сторінки посібника
- `/share`: містить файли, які повинні працювати на інших типах машин Unix без втрати функціональності

### Розташування ядра

У системах Linux ядро зазвичай знаходиться в `/vmlinuz` або `/boot/vmlinuz`.

`boot loader` завантажує цей файл у пам'ять і запускає його під час старту системи.

Ви знайдете багато модулів, які ядро може завантажувати та вивантажувати на вимогу під час нормальної роботи системи (так звані завантажувані модулі ядра).

## Виконання команд від імені суперкористувача

Ви можете запустити команду `su` та ввести пароль `root`, щоб запустити оболонку `root`. Ця практика працює, хоча:

- У вас не буду записів про команди, що змінюють систему
- У вас не буде записів про користувачів, які виконували команди, що змінюють систему
- Ви не матимете доступу до звичайного середовища оболонки
- Ви повинні ввести пароль користувача `root`

### sudo

`sudo` дозволяє адміністраторам запускати команди від імені `root`, якщо вони ввійшли в систему як самі. Коли ви запускаєте цю команду, `sudo` реєструє цю дію за допомогою служби системного журналу.

### `/etc/sudoers`

Щоб запустити sudo, необхідно налаштувати привілейованих користувачів у файлі `/etc/sudoers`. Приклад цього файлу наведено нижче:

```text
User_Alias ADMINS = user1, user2
ADMINS ALL = NOPASSWD: ALL
root ALL=(ALL) ALL
```

Перший рядок визначає псевдонім користувача ADMINS з двома користувачами, а другий рядок надає привілеї.

Частина `ALL = NOPASSWD: ALL` означає, що користувачі з псевдонімом `ADMINS` можуть використовувати sudo для виконання команд від імені root.

Друге `ALL` означає будь-яку команду. Перше `ALL` означає будь-який хост.

`root ALL=(ALL) ALL` означає, що суперкористувач також може використовувати sudo для виконання будь-якої команди на будь-якому хості.

Додатковий `(ALL)` означає, що суперкористувач також може виконувати команди як будь-який інший користувач.

Ви можете розширити цей привілей для користувачів `ADMINS`, додавши `(ALL)` до рядка `/etc/sudoers`: `ADMINS ALL = (ALL) NOPASSWD: ALL`
