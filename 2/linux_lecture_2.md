# Лінукс. Лекція 2. Загальна картина
## Рівні абстракції в системі Linux
Рівень — це класифікація (або групування) компонента відповідно до того, де цей компонент знаходиться між користувачем і обладнанням. Система Linux має три основні рівні: 
- апаратне забезпечення
- `простір ядра`
- процеси, які разом складають `простір користувача`.

Ядро працює в режимі ядра, який має необмежений доступ до процесора та основної пам'яті. Процеси користувача виконуються в режимі користувача, який обмежує доступ до (зазвичай досить невеликої) підмножини пам’яті та безпечних операцій ЦП.

![Linux levels](images/Figure1-1.png)
 
## Обладнання: розуміння основної пам'яті
Запущене ядро та процеси зберігаються в пам’яті (найважливіша частина апаратного забезпечення), ЦП – це лише оператор пам’яті, який допомогає процесу змінювати свій стан (`state`).

`State` у відношенні до пам’ятті – це певне розташування бітів.

![Process memory alignment](images/process_memory.png)
 
## Ядро
Одним із завдань ядра є розділення пам’яті на багато підрозділів, і воно має постійно підтримувати певну інформацію про стан цих підрозділів. Ядро відповідає за керування завданнями в чотирьох загальних областях системи:

- **Процеси**: визначає, яким процесам дозволено використовувати ЦП
- **Пам'ять**: відстежує всю пам'ять, наразі виділену певному процесу, спільну між процесами або вільну
- **Драйвери пристроїв**: діють як інтерфейс між обладнанням (наприклад, диском) і процесами
- **Системні виклики** та підтримка: процеси зазвичай використовують системні виклики для зв’язку з ядром
    
### Управління процесами
Керування процесами описує запуск, призупинення, відновлення та завершення процесів. Акт, коли один процес передає контроль над ЦП іншому, називається перемиканням контексту (за це відповідає ядро).

![Context switching](images/context_switching.webp)

### Керування пам'яттю
Ядро має керувати пам’яттю під час перемикання контексту, для цього ЦП включає блок керування пам’яттю (`MMU`), який діє як посередник між пам’яттю процесу та фізичним розташуванням самої пам’яті (реалізація карти адрес пам’яті називається таблицею сторінок).

![Virtual memory](images/virtual_memory.jpg)

### Драйвери пристроїв і керування
Пристрій зазвичай доступний лише в режимі ядра, оскільки неправильний доступ може призвести до збою машини та неправильній комунікації між інтерфейсами програмування пристроїв.

### Системні виклики та підтримка
Системні виклики (`syscalls`) виконують конкретні завдання, які процес користувача сам по собі не може виконати або виконати добре. Два важливі системні виклики:

- `fork()`: виклик, який створює майже ідентичну копію процесу.
- `exec()`: Коли процес викликає `exec(program)`, ядро запускає програму, замінюючи поточний процес.

![Linux process creation](images/Figure1-2.png)
    
Окрім `init`, усі користувацькі процеси в системі Linux запускаються як результат `fork()`, і здебільшого також запускають `exec()`, щоб запустити нову програму замість запуску копії існуючого процесу.

## Простір користувача
Основна пам'ять, яку ядро виділяє для процесів користувача, називається простором користувача. 

Оскільки процес — це просто стан (або образ) у пам’яті, простором користувача також називають ділянку пам'ті, де виконуються всі запущені в просторі користувача процеси.

![Linux user space](images/Figure1-3.png)

## Користувачі
Користувач — це суб’єкт, який може запускати процеси та володіти файлами. Користувач пов’язаний з `username`, ядро не керує іменами користувачів, натомість воно ідентифікує користувачів простими числовими ідентифікаторами, що називаються `userids`.

Користувачі існують насамперед для підтримки дозволів і обмежень. Кожен процес простору користувача має користувача власника, і кажуть, що процеси запускаються від імені власника.

Групи — це набори користувачів. Основна їхня мета — дозволити користувачеві надавати доступ до файлів іншим користувачам у групі.